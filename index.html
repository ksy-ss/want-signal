<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Signal Project</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        /* CSS ìŠ¤íƒ€ì¼ (ë””ìì¸) */
        :root {
            --main-color: #6200ea;
            --accent-color: #ffd700;
            --bg-color: #f8f5ff;
        }
        body { font-family: 'Noto Sans KR', sans-serif; background-color: var(--bg-color); margin: 0; padding: 20px; color: #333; }
        .container { max-width: 480px; margin: 0 auto; background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: var(--main-color); margin-bottom: 30px; line-height: 1.4; }
        h1 span { color: var(--main-color); background: linear-gradient(120deg, transparent 60%, var(--accent-color) 60%); padding: 0 5px; }
        
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: 500; color: #555; }
        select, input { width: 100%; padding: 12px; border: 2px solid #eee; border-radius: 12px; font-size: 16px; box-sizing: border-box; transition: 0.3s; }
        select:focus, input:focus { border-color: var(--main-color); outline: none; }
        
        .btn-submit { width: 100%; background-color: var(--main-color); color: white; border: none; padding: 16px; border-radius: 12px; font-size: 18px; font-weight: bold; cursor: pointer; transition: 0.3s; margin-top: 10px; }
        .btn-submit:hover { opacity: 0.9; transform: translateY(-2px); }
        .btn-stats { background-color: #fff; color: #555; border: 2px solid #eee; margin-top: 15px; font-size: 14px; }

        /* í†µê³„ ì˜ì—­ (ì´ˆê¸°ì—” ìˆ¨ê¹€) */
        #statsSection { display: none; margin-top: 30px; border-top: 2px dashed #eee; padding-top: 20px; }
        .chart-container { position: relative; height: 250px; width: 100%; margin-bottom: 20px; }
        
        .loading { text-align: center; display: none; margin: 10px 0; color: var(--main-color); }
    </style>
</head>
<body>

    <div class="container">
        <h1 id="mainTitle">ë¡œë”© ì¤‘...</h1>

        <div id="inputSection">
            <div class="form-group">
                <label id="keywordLabel">í‚¤ì›Œë“œ</label>
                <input type="text" id="keyword" placeholder="">
            </div>

            <div class="form-group">
                <label id="typeLabel">ë°©ì‹</label>
                <select id="typeSelect"></select>
            </div>

            <div class="form-group">
                <label id="budgetLabel">ì˜ˆì‚°</label>
                <select id="budgetSelect"></select>
            </div>

            <div class="form-group">
                <label id="timeLabel">ì‹œê°„</label>
                <select id="timeSelect"></select>
            </div>

            <button class="btn-submit" id="submitBtn" onclick="sendSignal()">ì‹œê·¸ë„ ë³´ë‚´ê¸°</button>
            <div class="loading" id="loadingMsg"><i class="fas fa-spinner fa-spin"></i> ì „ì†¡ ì¤‘...</div>
            
            <button class="btn-submit btn-stats" id="statsBtn" onclick="toggleStats()">ğŸ“Š íŠ¸ë Œë“œ ë³´ê¸°</button>
        </div>

        <div id="statsSection">
            <h3 id="statTitle" style="text-align: center;"></h3>
            <h4 id="chartTitle1"></h4>
            <div class="chart-container">
                <canvas id="typeChart"></canvas>
            </div>
            <div id="rankList"></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getDatabase, ref, push, onValue, query, limitToLast } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

        // ============================================================
        // [ì¤‘ìš”] ì‚¬ì¥ë‹˜ì˜ Firebase ì„¤ì •ê°’ì„ ì—¬ê¸°ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”!
        // ============================================================
        const firebaseConfig = {
    apiKey: "AIzaSyB6WjGUEn0fEg_k4Yk15bhzAFDoo7RcqWg",
    authDomain: "want-log-v2.firebaseapp.com",
    databaseURL: "https://want-log-v2-default-rtdb.firebaseio.com",
    projectId: "want-log-v2",
    storageBucket: "want-log-v2.firebasestorage.app",
    messagingSenderId: "142800647324",
    appId: "1:142800647324:web:e3100ec7b4daa8467ae959",
    measurementId: "G-HZ4HBQH697"
  };


        // Firebase ì´ˆê¸°í™”
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // ============================================================
        // APP CONFIG ì„¤ì • (ì›í•˜ëŠ” ë²„ì „ì˜ ì£¼ì„ì„ í’€ì–´ì„œ ì‚¬ìš©í•˜ì„¸ìš”)
        // ============================================================
        
        /* [ì˜µì…˜ 1] ë·°í‹° ì‹œê·¸ë„ */
        /*
        const APP_CONFIG = {
            appName: "beauty_signal",
            colors: { main: "#6200ea", accent: "#ffd700", bg: "#f8f5ff" },
            text: {
                mainTitle: "ì˜ˆë»ì§€ëŠ” ì‹ í˜¸,<br><span>ë·°í‹° ì‹œê·¸ë„</span>ì„ ì¼œì„¸ìš”!",
                keywordLabel: "ì‹œìˆ /ê³ ë¯¼ í‚¤ì›Œë“œ", keywordPlace: "ex. ì¸ëª¨ë“œ, ì…ìˆ í•„ëŸ¬",
                typeLabel: "ì›í•˜ëŠ” ë°©ì‹", budgetLabel: "ì˜ˆìƒ ë¹„ìš©", timeLabel: "ë§¤ì¹­ ë§ˆê°",
                submitBtn: "ë·°í‹° ì‹œê·¸ë„ ì†¡ì¶œ", statTitle: "ì–¸ë‹ˆë“¤ì˜ ë·°í‹° íŠ¸ë Œë“œ", chartTitle1: "ğŸ”¥ ì¸ê¸°ìˆëŠ” ë°©ì‹ Top 4"
            },
            options: {
                type: [{val:"together", label:"ì •ë³´êµí™˜"}, {val:"empathy", label:"ë™í–‰"}, {val:"exchange", label:"ê³µêµ¬"}, {val:"transfer", label:"ì–‘ë„"}],
                budget: [{val:"free", label:"ë¯¸ì •"}, {val:"30", label:"10ë§Œì›ëŒ€"}, {val:"50", label:"50ë§Œì›ëŒ€"}, {val:"high", label:"ê³ ê°€"}],
                time: [{val:"1h", label:"ê¸‰êµ¬"}, {val:"today", label:"ì˜¤ëŠ˜"}, {val:"week", label:"ì´ë²ˆì£¼"}]
            }
        };
        */

        /* [ì˜µì…˜ 2] ìš•êµ¬ì§€ë„ ì‹œê·¸ë„ (í˜„ì¬ í™œì„±í™”) */
        const APP_CONFIG = {
    appName: "desire_map_basic", 
    colors: {
        main: "#2980b9",    // ì˜¤ì…˜ ë¸”ë£¨ (ì‹ ë¢°/í¬ë§)
        accent: "#e74c3c",  // ë ˆë“œ (ìš•ë§/ê°•ë ¬í•¨)
        bg: "#ecf0f1"       // ì¿¨ í™”ì´íŠ¸
    },
    text: {
        mainTitle: "ë‹¹ì‹ ì˜ ëª¨ë“  ìš•êµ¬,<br><span>ìš•êµ¬ ì§€ë„</span>ì— ê¸°ë¡í•˜ì„¸ìš”.",
        keywordLabel: "ë¬´ì—‡ì„ ì›í•˜ì‹œë‚˜ìš”?",
        keywordPlace: "ex. ì¹˜í‚¨, ë§¥ë¶ í”„ë¡œ, ì´ì§, íœ´ê°€, ë¡œë˜",
        typeLabel: "ìš•êµ¬ì˜ ì¢…ë¥˜",
        budgetLabel: "í•„ìš” ë¹„ìš©",
        timeLabel: "ì›í•˜ëŠ” ì‹œê¸°",
        submitBtn: "ì§€ë„ì— ì¢Œí‘œ ì°ê¸°",
        inputBtn: "ìš•êµ¬ ê¸°ë¡í•˜ê¸°",
        statsBtn: "ğŸ“Š ì „ì²´ ì§€ë„ ë³´ê¸°",
        statTitle: "ì‚¬ëŒë“¤ì˜ ì‹¤ì‹œê°„<br><span>ìš•ë§ íŠ¸ë Œë“œ</span>",
        chartTitle1: "ğŸ”¥ ê°€ì¥ ë§ì´ ì›í•˜ëŠ” ê²ƒ Top 5"
    },
    options: {
        type: [
            { val: "food", label: "ğŸ” ì‹ìš• (ë§›ì§‘/ë°°ë‹¬)" },
            { val: "item", label: "ğŸ ë¬¼ìš• (ì‡¼í•‘/ì¥ë¹„)" },
            { val: "experience", label: "âœˆï¸ ê²½í—˜ (ì—¬í–‰/ë¬¸í™”)" },
            { val: "goal", label: "ğŸ† ì„±ì·¨ (ê³µë¶€/ì´ì§/ìš´ë™)" }
        ],
        budget: [
            { val: "small", label: "ì†Œì†Œí•˜ê²Œ (3ë§Œì› ì´í•˜)" },
            { val: "medium", label: "ì ë‹¹íˆ (10ë§Œì› ëŒ€)" },
            { val: "big", label: "í° ë§˜ ë¨¹ê³  (50ë§Œì› â†‘)" },
            { val: "dream", label: "ìƒìƒ ê·¸ ì´ìƒ (ê°€ê²©ë¯¸ì •)" }
        ],
        time: [
            { val: "now", label: "ì§€ê¸ˆ ë‹¹ì¥ (Urgent)" },
            { val: "week", label: "ì´ë²ˆ ì£¼ ë‚´ë¡œ" },
            { val: "month", label: "ì´ë²ˆ ë‹¬ ì•ˆì—" },
            { val: "bucket", label: "ì–¸ì  ê°€ëŠ” (ë²„í‚·ë¦¬ìŠ¤íŠ¸)" }
        ]
    }
};
        // ============================================================
        // 1. í™”ë©´ ì´ˆê¸°í™” (Config ì ìš©)
        // ============================================================
        document.documentElement.style.setProperty('--main-color', APP_CONFIG.colors.main);
        document.documentElement.style.setProperty('--accent-color', APP_CONFIG.colors.accent);
        document.documentElement.style.setProperty('--bg-color', APP_CONFIG.colors.bg);
        
        document.getElementById('mainTitle').innerHTML = APP_CONFIG.text.mainTitle;
        document.getElementById('keywordLabel').innerText = APP_CONFIG.text.keywordLabel;
        document.getElementById('keyword').placeholder = APP_CONFIG.text.keywordPlace;
        document.getElementById('typeLabel').innerText = APP_CONFIG.text.typeLabel;
        document.getElementById('budgetLabel').innerText = APP_CONFIG.text.budgetLabel;
        document.getElementById('timeLabel').innerText = APP_CONFIG.text.timeLabel;
        document.getElementById('submitBtn').innerText = APP_CONFIG.text.submitBtn;
        document.getElementById('statTitle').innerHTML = APP_CONFIG.text.statTitle;
        document.getElementById('chartTitle1').innerText = APP_CONFIG.text.chartTitle1;

        // ì˜µì…˜ ì±„ìš°ê¸° í•¨ìˆ˜
        function fillSelect(id, list) {
            const el = document.getElementById(id);
            list.forEach(opt => {
                let option = document.createElement('option');
                option.value = opt.val;
                option.text = opt.label;
                el.appendChild(option);
            });
        }
        fillSelect('typeSelect', APP_CONFIG.options.type);
        fillSelect('budgetSelect', APP_CONFIG.options.budget);
        fillSelect('timeSelect', APP_CONFIG.options.time);

        // ì „ì—­ í•¨ìˆ˜ë¡œ ë§Œë“¤ê¸° (HTMLì—ì„œ onclickìœ¼ë¡œ ì“°ê¸° ìœ„í•´)
        window.sendSignal = function() {
            const keyword = document.getElementById('keyword').value;
            if(!keyword) { alert('í‚¤ì›Œë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!'); return; }

            const data = {
                keyword: keyword,
                type: document.getElementById('typeSelect').value,
                budget: document.getElementById('budgetSelect').value,
                time: document.getElementById('timeSelect').value,
                timestamp: new Date().toISOString()
            };

            document.getElementById('loadingMsg').style.display = 'block';
            document.getElementById('submitBtn').disabled = true;

            // Firebaseì— ë°ì´í„° ì €ì¥
            push(ref(db, APP_CONFIG.appName), data)
                .then(() => {
                    alert('ì‹ í˜¸ê°€ ì •ìƒì ìœ¼ë¡œ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ“¡');
                    document.getElementById('keyword').value = ''; // ì´ˆê¸°í™”
                })
                .catch((error) => {
                    alert('ì „ì†¡ ì‹¤íŒ¨: ' + error.message);
                })
                .finally(() => {
                    document.getElementById('loadingMsg').style.display = 'none';
                    document.getElementById('submitBtn').disabled = false;
                });
        };

        // ============================================================
        // 2. í†µê³„ ê¸°ëŠ¥ (ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ë° ì°¨íŠ¸ ê·¸ë¦¬ê¸°)
        // ============================================================
        let chartInstance = null;

        window.toggleStats = function() {
            const statsDiv = document.getElementById('statsSection');
            if(statsDiv.style.display === 'none' || statsDiv.style.display === '') {
                statsDiv.style.display = 'block';
                loadStats(); // ë°ì´í„° ë¡œë“œ ì‹œì‘
            } else {
                statsDiv.style.display = 'none';
            }
        };

        function loadStats() {
            // ìµœê·¼ 100ê°œ ë°ì´í„°ë§Œ ê°€ì ¸ì™€ì„œ í†µê³„ ë‚´ê¸° (ë°ì´í„° ì ˆì•½)
            const recentPosts = query(ref(db, APP_CONFIG.appName), limitToLast(100));
            
            onValue(recentPosts, (snapshot) => {
                const data = snapshot.val();
                if(!data) return;

                // ë°ì´í„° ì§‘ê³„
                const typeCounts = {};
                Object.values(data).forEach(item => {
                    // Configì— ìˆëŠ” ë¼ë²¨ë¡œ ë³€í™˜í•´ì„œ ì¹´ìš´íŠ¸
                    const labelObj = APP_CONFIG.options.type.find(opt => opt.val === item.type);
                    const label = labelObj ? labelObj.label : item.type;
                    typeCounts[label] = (typeCounts[label] || 0) + 1;
                });

                drawChart(typeCounts);
            });
        }

        function drawChart(counts) {
            const ctx = document.getElementById('typeChart').getContext('2d');
            
            // ê¸°ì¡´ ì°¨íŠ¸ ìˆìœ¼ë©´ ì‚­ì œ (ê²¹ì¹¨ ë°©ì§€)
            if(chartInstance) chartInstance.destroy();

            chartInstance = new Chart(ctx, {
                type: 'doughnut', // ë„ë„› ì°¨íŠ¸
                data: {
                    labels: Object.keys(counts),
                    datasets: [{
                        data: Object.values(counts),
                        backgroundColor: [
                            APP_CONFIG.colors.main,
                            APP_CONFIG.colors.accent,
                            '#bdc3c7',
                            '#34495e'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });
        }
    </script>
</body>
</html>